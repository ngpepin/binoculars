{
  "binoculars_gui_state": true,
  "version": 1,
  "saved_at": "2026-02-13T22:58:29Z",
  "document_path": "/home/npepin/Projects/binoculars/USERGUIDE-GUI_TEST.md",
  "document_basename": "USERGUIDE-GUI_TEST.md",
  "text_sha256": "e6ec3d68752d251d9c933fd0f4cd19e8db8b6e9f7ee70afa662c9229f7e1654a",
  "state": {
    "baseline_text": "# Binoculars GUI User Guide\n\nThis manual details the operation of the Binoculars graphical interface for iterative editing and rescoring. The workflow is designed for rapid rewrite cycles using approximate impact feedback, with periodic full `Analyze` runs to obtain precise metrics, and regular use of `Clear Priors` to maintain a clear display.\n\n## 1) Starting the GUI\n\nFrom the repository root, execute:\n\n```bash\n./binoculars.sh --config fast --gui path/to/doc.md\n```\n\nAlternatively:\n\n```bash\nvenv/bin/python binoculars.py --config fast --gui path/to/doc.md\n```\n\n## 2) Interface Layout\n\nThe main interface consists of several sections:\n- Left pane: editable source text.\n- Left gutter: line numbers and per-line contribution indicators.\n- Right pane: markdown preview, with backgrounds reflecting score data.\n- Right-pane footer: synonym panel, activated by clicking on words.\n- Toolbar: `Analyze`, `Save`, `Undo`, `Clear Priors`, `Quit`.\n- Status bar: displays current score, metrics, and workflow state.\n\nColour conventions after running Analyze:\n- Red foreground lines or segments: lower-perplexity (`LOW`) contributors.\n- Green foreground lines or segments: higher-perplexity (`HIGH`) contributors.\n- Yellow foreground: your edits since the last Analyze.\n- Faint background colours: previous analyzes or edits, retained for comparison.\n\n## 3) Core Workflow Structure\n\nThe GUI separates editing into two phases.\n\n1. Approximate iteration phase:\n   - Edit text.\n   - Request rewrites.\n   - Review approximate B impact in the rewrite popup.\n   - Apply options quickly.\n\n2. Exact scoring phase:\n   - Run `Analyze` at intervals.\n   - Refresh exact `B`, observer/cross metrics, and heatmap labels.\n\nKey points:\n- The impact values shown in the rewrite popup are only estimates.\n- To get the true value of B, you need to perform a full `Analyze`.\n- Any time you edit or apply a rewrite, B is marked as stale in the status bar until you run Analyze again.\n\n## 4) Recommended Iteration Loop\n\nFor efficient throughput, use this sequence:\n\n1. Press `Analyze` on the current document.\n2. Inspect red and green contributors.\n3. Edit directly or request rewrites.\n4. Apply one or more rewrite options (auto-analyze does not trigger).\n5. Continue editing while monitoring the stale indicator.\n6. Re-run `Analyze` when you need to confirm the exact score.\n7. Use `Undo` to revert the last tracked change.\n8. Press `Clear Priors` if overlays become visually distracting.\n9. Repeat as needed.\n\nRecommended cadence:\n- Run `Analyze` every few rewrites (for example, every 3–8), or after a major section change.\n- Run `Clear Priors` if faint backgrounds begin to obscure current hot spots.\n\n### 4.1) Chunk-Aware Analyze Behaviour (Large Files)\n\nWhen a document is too large for one-pass scoring, analysis is chunked.\n\n- First `Analyze` starts at line 1 (document start) and scores the first token-limited chunk.\n- `Analyze Next` continues from the highest contiguous covered tail into the next chunk.\n- After at least one chunk exists, pressing `Analyze` does not start at the cursor line; it starts at the active chunk start.\n- Active chunk is chosen by overlap priority (selection overlap, then visible cursor chunk, then visible-window majority, then nearest chunk).\n- Chunk metrics in the status bar always refer to the active chunk.\n- Chunk boundaries can change after edits and re-analysis.\n\nConcrete example:\n\n1. First `Analyze` produces chunk 1 covering lines `1-999`.\n2. You move cursor to line `999` and press `Analyze`.\n3. Binoculars re-analyzes from chunk-1 start (line `1`), not from line `999`.\n4. Because edits changed token density, the new chunk-1 end may shift:\n   - It could contract to line `972`, or\n   - It could extend to line `1031`.\n5. The previous overlapping chunk descriptor is replaced by this new one.\n6. Status-bar values now reflect the updated chunk range.\n\n## 5) Requesting Rewrites\n\n### A) Rewrite a Single Scored Red Segment\n\n1. Ensure at least one successful `Analyze` run has completed.\n2. Right-click directly on a red (`LOW`) segment.\n3. Wait for the popup to generate and score options.\n4. Review options `[1]`, `[2]`, `[3]`, each with an approximate B impact.\n5. Select an option using the button or keyboard: `1`, `2`, or `3`.\n6. The selected text replaces the segment in the left pane.\n\n### B) Rewrite a Highlighted Block (Multi-Line)\n\n1. Highlight any block in the left pane (may include mixed LOW/HIGH/neutral lines).\n2. Right-click while the selection is active.\n3. The GUI rounds the selection to full lines for rewrite generation.\n4. If the selection includes unscored text, those lines are retained unchanged while scored/analyzed lines are rewritten.\n5. The popup displays three options and approximate B deltas.\n6. Select an option using the button or `1`/`2`/`3`.\n\nSelection rewrite behaviour:\n- Unchanged source lines are preserved, even if the model output omits or collapses them.\n- Trailing blank lines from the selected source are retained in the replacement.\n\n## 6) Rewrite Popup Details\n\nPopup features:\n- Scrollable option body for long rewrites.\n- Status and progress lines during generation.\n- Source label indicates the rewrite backend:\n  - `external LLM`\n  - `internal fallback`\n  - `internal model`\n- `Quit` or `Esc` cancels with no change.\n\nOption order:\n- Sorted by expected increase in B (most human-like first).\n\n## 7) Synonym Finder and One-Level Undo\n\nThe synonym finder operates as follows. Left-click a word in the left pane. After a brief delay, the synonym panel appears, displaying up to nine options arranged in three columns. To select a synonym, click the button `1..9` in the panel. The replacement is inserted into the left pane and highlighted in yellow to indicate an edit.\n\nSynonym sources are prioritized in this order: the local fallback list, WordNet (if available in the environment), and the Datamuse API as a fallback.\n\nOne-level Undo is supported. The command `Undo` reverts exactly one tracked operation. Supported tracked operations include selected-block delete (`Delete` or `Backspace`), synonym replacement, single red-segment rewrite replacement, and highlighted-block rewrite replacement. Undo is intentionally limited to one level. If the text changes after the tracked operation, Undo is invalidated for safety.\n\n## 8) Exact vs Approximate Metrics\n\nApproximate values in the popup are designed for quickly ranking options. They do not recompute the full document cross term.\n\nExact values in the status bar are updated only by `Analyze`. These include exact `B`, `Observer logPPL`, `Performer logPPL`, `Cross logXPPL`, and scored `Last Line`.\n\n## 9) Prior Overlays and `Clear Priors`\n\nPriors are faint background traces of previous analyzes and edits. They provide visual context for “before vs after”.\n\nClearing priors is recommended after several iteration cycles when old context becomes distracting, or before a final review pass if only the latest heatmap should be visible.\n\nThe `Clear Priors` command removes faint prior backgrounds. It does not alter the current text and does not run Analyze.\n\n## 10) Preview Pane Selection Mirroring\n\nWhen a block is highlighted on the left, the right preview mirrors the same selected block. Within the selected block, LOW lines display a red-tinted background, HIGH lines use a green-tinted background, and neutral lines use a neutral highlight style.\n\nThis approach makes it easier to inspect local context before requesting rewrites.\n\n## 11) Saving and Output Files\n\n`Save` creates timestamped files alongside the original source file.\n\n- `[[HTML_BLOCK_0]]_edited_YYYYMMDDHHMM.md`\n- If a filename conflict occurs, a numeric suffix is added.\n\nTip: Save snapshots at key points - such as after each Analyze-confirmed change. When you save, a modal popup displays the destination filename while the write operation completes.\n\n## 12) Optional External Rewrite Backend (`Config.Binoculars.Llm.Json`)\n\nIf an external backend is configured and available, rewrite generation can use any OpenAI-compatible endpoint. If the configuration is missing, disabled, or unreachable, the GUI defaults to the internal performer model.\n\nTypical fields include:\n- `llm.enabled`\n- `llm.endpoint_url`\n- `llm.request_path`\n- `llm.model`\n- `llm.api_key` or `llm.api_key_env`\n- `llm.timeout_s`, `llm.max_tokens`, `llm.temperature`, `llm.top_p`\n- Context controls (`context_chars_each_side`, `context_paragraphs_each_side`, `context_window_max_chars`)\n- `llm.extra_headers`, `llm.extra_body`\n\n## 13) Troubleshooting\n\nRewrite menu will not open:\n- Run `Analyze` at least once before attempting to open the menu.\n- Make sure no analysis or rewrite operation is currently running.\n\nRewrite generation is slow:\n- The first run may require model warmup.\n- Latency from an external endpoint can be significant.\n- If needed, reduce context fields in `config.binoculars.llm.json`.\n\nUndo button is disabled or Undo fails:\n- Undo supports only one tracked operation at a time.\n- If the document changes after that operation, Undo is invalidated.\n\nB score does not match popup deltas:\n- Popup deltas are approximate.\n- Run a full `Analyze` for exact values.\n\nStatus-bar messages disappear:\n- Non-analysis workflow messages are temporary; metrics are restored automatically.\n- `Analyzing...` stays visible until analysis finishes.\n\nVisual clutter is high:\n- Use `Clear Priors` and continue the iteration process.\n\n---\n\nPractical summary:\n- Use rewrites, synonym swaps, and direct edits for rapid local iteration.\n- Rely on popup numbers for relative ranking.\n- Use `Analyze` as the precise checkpoint.\n- Use one-level `Undo` to quickly revert the last tracked change.\n- Use `Clear Priors` for a periodic visual reset.\n",
    "prev_text": "# Binoculars GUI User Guide\n\nThis manual details the operation of the Binoculars graphical interface for iterative editing and rescoring. The workflow is designed for rapid rewrite cycles using approximate impact feedback, with periodic full `Analyze` runs to obtain precise metrics, and regular use of `Clear Priors` to maintain a clear display.\n\n## 1) Starting the GUI\n\nFrom the repository root, execute:\n\n```bash\n./binoculars.sh --config fast --gui path/to/doc.md\n```\n\nAlternatively:\n\n```bash\nvenv/bin/python binoculars.py --config fast --gui path/to/doc.md\n```\n\n## 2) Interface Layout\n\nThe main interface consists of several sections:\n- Left pane: editable source text.\n- Left gutter: line numbers and per-line contribution indicators.\n- Right pane: markdown preview, with backgrounds reflecting score data.\n- Right-pane footer: synonym panel, activated by clicking on words.\n- Toolbar: `Analyze`, `Save`, `Undo`, `Clear Priors`, `Quit`.\n- Status bar: displays current score, metrics, and workflow state.\n\nColour conventions after running Analyze:\n- Red foreground lines or segments: lower-perplexity (`LOW`) contributors.\n- Green foreground lines or segments: higher-perplexity (`HIGH`) contributors.\n- Yellow foreground: your edits since the last Analyze.\n- Faint background colours: previous analyzes or edits, retained for comparison.\n\n## 3) Core Workflow Structure\n\nThe GUI separates editing into two phases.\n\n1. Approximate iteration phase:\n   - Edit text.\n   - Request rewrites.\n   - Review approximate B impact in the rewrite popup.\n   - Apply options quickly.\n\n2. Exact scoring phase:\n   - Run `Analyze` at intervals.\n   - Refresh exact `B`, observer/cross metrics, and heatmap labels.\n\nKey points:\n- The impact values shown in the rewrite popup are only estimates.\n- To get the true value of B, you need to perform a full `Analyze`.\n- Any time you edit or apply a rewrite, B is marked as stale in the status bar until you run Analyze again.\n\n## 4) Recommended Iteration Loop\n\nFor efficient throughput, use this sequence:\n\n1. Press `Analyze` on the current document.\n2. Inspect red and green contributors.\n3. Edit directly or request rewrites.\n4. Apply one or more rewrite options (auto-analyze does not trigger).\n5. Continue editing while monitoring the stale indicator.\n6. Re-run `Analyze` when you need to confirm the exact score.\n7. Use `Undo` to revert the last tracked change.\n8. Press `Clear Priors` if overlays become visually distracting.\n9. Repeat as needed.\n\nRecommended cadence:\n- Run `Analyze` every few rewrites (for example, every 3–8), or after a major section change.\n- Run `Clear Priors` if faint backgrounds begin to obscure current hot spots.\n\n### 4.1) Chunk-Aware Analyze Behaviour (Large Files)\n\nWhen a document is too large for one-pass scoring, analysis is chunked.\n\n- First `Analyze` starts at line 1 (document start) and scores the first token-limited chunk.\n- `Analyze Next` continues from the highest contiguous covered tail into the next chunk.\n- After at least one chunk exists, pressing `Analyze` does not start at the cursor line; it starts at the active chunk start.\n- Active chunk is chosen by overlap priority (selection overlap, then visible cursor chunk, then visible-window majority, then nearest chunk).\n- Chunk metrics in the status bar always refer to the active chunk.\n- Chunk boundaries can change after edits and re-analysis.\n\nConcrete example:\n\n1. First `Analyze` produces chunk 1 covering lines `1-999`.\n2. You move cursor to line `999` and press `Analyze`.\n3. Binoculars re-analyzes from chunk-1 start (line `1`), not from line `999`.\n4. Because edits changed token density, the new chunk-1 end may shift:\n   - It could contract to line `972`, or\n   - It could extend to line `1031`.\n5. The previous overlapping chunk descriptor is replaced by this new one.\n6. Status-bar values now reflect the updated chunk range.\n\n## 5) Requesting Rewrites\n\n### A) Rewrite a Single Scored Red Segment\n\n1. Ensure at least one successful `Analyze` run has completed.\n2. Right-click directly on a red (`LOW`) segment.\n3. Wait for the popup to generate and score options.\n4. Review options `[1]`, `[2]`, `[3]`, each with an approximate B impact.\n5. Select an option using the button or keyboard: `1`, `2`, or `3`.\n6. The selected text replaces the segment in the left pane.\n\n### B) Rewrite a Highlighted Block (Multi-Line)\n\n1. Highlight any block in the left pane (may include mixed LOW/HIGH/neutral lines).\n2. Right-click while the selection is active.\n3. The GUI rounds the selection to full lines for rewrite generation.\n4. If the selection includes unscored text, those lines are retained unchanged while scored/analyzed lines are rewritten.\n5. The popup displays three options and approximate B deltas.\n6. Select an option using the button or `1`/`2`/`3`.\n\nSelection rewrite behaviour:\n- Unchanged source lines are preserved, even if the model output omits or collapses them.\n- Trailing blank lines from the selected source are retained in the replacement.\n\n## 6) Rewrite Popup Details\n\nPopup features:\n- Scrollable option body for long rewrites.\n- Status and progress lines during generation.\n- Source label indicates the rewrite backend:\n  - `external LLM`\n  - `internal fallback`\n  - `internal model`\n- `Quit` or `Esc` cancels with no change.\n\nOption order:\n- Sorted by expected increase in B (most human-like first).\n\n## 7) Synonym Finder and One-Level Undo\n\nThe synonym finder operates as follows. Left-click a word in the left pane. After a brief delay, the synonym panel appears, displaying up to nine options arranged in three columns. To select a synonym, click the button `1..9` in the panel. The replacement is inserted into the left pane and highlighted in yellow to indicate an edit.\n\nSynonym sources are prioritized in this order: the local fallback list, WordNet (if available in the environment), and the Datamuse API as a fallback.\n\nOne-level Undo is supported. The command `Undo` reverts exactly one tracked operation. Supported tracked operations include selected-block delete (`Delete` or `Backspace`), synonym replacement, single red-segment rewrite replacement, and highlighted-block rewrite replacement. Undo is intentionally limited to one level. If the text changes after the tracked operation, Undo is invalidated for safety.\n\n## 8) Exact vs Approximate Metrics\n\nApproximate values in the popup are designed for quickly ranking options. They do not recompute the full document cross term.\n\nExact values in the status bar are updated only by `Analyze`. These include exact `B`, `Observer logPPL`, `Performer logPPL`, `Cross logXPPL`, and scored `Last Line`.\n\n## 9) Prior Overlays and `Clear Priors`\n\nPriors are faint background traces of previous analyzes and edits. They provide visual context for “before vs after”.\n\nClearing priors is recommended after several iteration cycles when old context becomes distracting, or before a final review pass if only the latest heatmap should be visible.\n\nThe `Clear Priors` command removes faint prior backgrounds. It does not alter the current text and does not run Analyze.\n\n## 10) Preview Pane Selection Mirroring\n\nWhen a block is highlighted on the left, the right preview mirrors the same selected block. Within the selected block, LOW lines display a red-tinted background, HIGH lines use a green-tinted background, and neutral lines use a neutral highlight style.\n\nThis approach makes it easier to inspect local context before requesting rewrites.\n\n## 11) Saving and Output Files\n\n`Save` creates timestamped files alongside the original source file.\n\n- `[[HTML_BLOCK_0]]_edited_YYYYMMDDHHMM.md`\n- If a filename conflict occurs, a numeric suffix is added.\n\nTip: Save snapshots at key points - such as after each Analyze-confirmed change. When you save, a modal popup displays the destination filename while the write operation completes.\n\n## 12) Optional External Rewrite Backend (`Config.Binoculars.Llm.Json`)\n\nIf an external backend is configured and available, rewrite generation can use any OpenAI-compatible endpoint. If the configuration is missing, disabled, or unreachable, the GUI defaults to the internal performer model.\n\nTypical fields include:\n- `llm.enabled`\n- `llm.endpoint_url`\n- `llm.request_path`\n- `llm.model`\n- `llm.api_key` or `llm.api_key_env`\n- `llm.timeout_s`, `llm.max_tokens`, `llm.temperature`, `llm.top_p`\n- Context controls (`context_chars_each_side`, `context_paragraphs_each_side`, `context_window_max_chars`)\n- `llm.extra_headers`, `llm.extra_body`\n\n## 13) Troubleshooting\n\nRewrite menu will not open:\n- Run `Analyze` at least once before attempting to open the menu.\n- Make sure no analysis or rewrite operation is currently running.\n\nRewrite generation is slow:\n- The first run may require model warmup.\n- Latency from an external endpoint can be significant.\n- If needed, reduce context fields in `config.binoculars.llm.json`.\n\nUndo button is disabled or Undo fails:\n- Undo supports only one tracked operation at a time.\n- If the document changes after that operation, Undo is invalidated.\n\nB score does not match popup deltas:\n- Popup deltas are approximate.\n- Run a full `Analyze` for exact values.\n\nStatus-bar messages disappear:\n- Non-analysis workflow messages are temporary; metrics are restored automatically.\n- `Analyzing...` stays visible until analysis finishes.\n\nVisual clutter is high:\n- Use `Clear Priors` and continue the iteration process.\n\n---\n\nPractical summary:\n- Use rewrites, synonym swaps, and direct edits for rapid local iteration.\n- Rely on popup numbers for relative ranking.\n- Use `Analyze` as the precise checkpoint.\n- Use one-level `Undo` to quickly revert the last tracked change.\n- Use `Clear Priors` for a periodic visual reset.\n",
    "has_analysis": true,
    "b_score_stale": true,
    "last_b_score": 0.9572708802814595,
    "last_analysis_status_core": "B 0.95727 | Obs 2.28074 | Cross 2.38254",
    "last_analysis_metrics": {
      "binoculars_score": 0.9572708802814595,
      "observer_logPPL": 2.280736769636093,
      "performer_logPPL": 2.3532366873785597,
      "cross_logXPPL": 2.38254063360363,
      "transitions": 2177
    },
    "analyzed_char_end": 9645,
    "analysis_chunks": [
      {
        "id": 1,
        "char_start": 0,
        "char_end": 9645,
        "analyzed_char_end": 9645,
        "metrics": {
          "binoculars_score": 0.9572708802814595,
          "observer_logPPL": 2.280736769636093,
          "performer_logPPL": 2.3532366873785597,
          "cross_logXPPL": 2.38254063360363,
          "transitions": 2177
        },
        "profile": null,
        "rows": [
          {
            "paragraph_id": 1,
            "char_start": 0,
            "char_end": 27,
            "logPPL": 5.225656636981315,
            "delta_doc_logPPL_if_removed": -0.009499741507565052,
            "excerpt": "# Binoculars GUI User Guide"
          },
          {
            "paragraph_id": 2,
            "char_start": 29,
            "char_end": 346,
            "logPPL": 3.695243838146102,
            "delta_doc_logPPL_if_removed": -0.04008994998138915,
            "excerpt": "This manual details the operation of the Binoculars graphical interface for iterative editing and rescoring. The workflow is designed for..."
          },
          {
            "paragraph_id": 3,
            "char_start": 348,
            "char_end": 370,
            "logPPL": 2.206401002787071,
            "delta_doc_logPPL_if_removed": 0.00023979279628694172,
            "excerpt": "## 1) Starting the GUI"
          },
          {
            "paragraph_id": 4,
            "char_start": 372,
            "char_end": 406,
            "logPPL": 2.6019638402304017,
            "delta_doc_logPPL_if_removed": -0.0010362163567556593,
            "excerpt": "From the repository root, execute:"
          },
          {
            "paragraph_id": 5,
            "char_start": 408,
            "char_end": 470,
            "logPPL": 2.6846628410266975,
            "delta_doc_logPPL_if_removed": -0.0035563463190091404,
            "excerpt": "```bash ./binoculars.sh --config fast --gui path/to/doc.md ```"
          },
          {
            "paragraph_id": 6,
            "char_start": 472,
            "char_end": 486,
            "logPPL": 4.236585454848704,
            "delta_doc_logPPL_if_removed": -0.0017984815496210338,
            "excerpt": "Alternatively:"
          },
          {
            "paragraph_id": 7,
            "char_start": 488,
            "char_end": 564,
            "logPPL": 0.5972227992762147,
            "delta_doc_logPPL_if_removed": 0.017186685544277047,
            "excerpt": "```bash venv/bin/python binoculars.py --config fast --gui path/to/doc.md ```"
          },
          {
            "paragraph_id": 8,
            "char_start": 566,
            "char_end": 588,
            "logPPL": 1.4574489978067238,
            "delta_doc_logPPL_if_removed": 0.0022753231833143595,
            "excerpt": "## 2) Interface Layout"
          },
          {
            "paragraph_id": 9,
            "char_start": 590,
            "char_end": 1008,
            "logPPL": 2.362190892717833,
            "delta_doc_logPPL_if_removed": -0.0035126358779860034,
            "excerpt": "The main interface consists of several sections: - Left pane: editable source text. - Left gutter: line numbers and per-line contribution..."
          },
          {
            "paragraph_id": 10,
            "char_start": 1010,
            "char_end": 1342,
            "logPPL": 2.768605314842146,
            "delta_doc_logPPL_if_removed": -0.015253114156134728,
            "excerpt": "Colour conventions after running Analyze: - Red foreground lines or segments: lower-perplexity (`LOW`) contributors. - Green foreground l..."
          },
          {
            "paragraph_id": 11,
            "char_start": 1344,
            "char_end": 1373,
            "logPPL": 2.2681151001178956,
            "delta_doc_logPPL_if_removed": 0.000040715062961549364,
            "excerpt": "## 3) Core Workflow Structure"
          },
          {
            "paragraph_id": 12,
            "char_start": 1375,
            "char_end": 1417,
            "logPPL": 3.307825210995093,
            "delta_doc_logPPL_if_removed": -0.003788246902200143,
            "excerpt": "The GUI separates editing into two phases."
          },
          {
            "paragraph_id": 13,
            "char_start": 1419,
            "char_end": 1572,
            "logPPL": 3.2918495445147986,
            "delta_doc_logPPL_if_removed": -0.016521450569913387,
            "excerpt": "1. Approximate iteration phase: - Edit text. - Request rewrites. - Review approximate B impact in the rewrite popup. - Apply options quic..."
          },
          {
            "paragraph_id": 14,
            "char_start": 1574,
            "char_end": 1698,
            "logPPL": 2.68957453211517,
            "delta_doc_logPPL_if_removed": -0.006099211374979152,
            "excerpt": "2. Exact scoring phase: - Run `Analyze` at intervals. - Refresh exact `B`, observer/cross metrics, and heatmap labels."
          },
          {
            "paragraph_id": 15,
            "char_start": 1700,
            "char_end": 1885,
            "logPPL": 1.994070224583902,
            "delta_doc_logPPL_if_removed": 0.006050654093502583,
            "excerpt": "Key points: - Impact values in the rewrite popup are estimates. - Exact B requires a full `Analyze` run. - After edits or rewrites, the s..."
          },
          {
            "paragraph_id": 16,
            "char_start": 1887,
            "char_end": 1919,
            "logPPL": 2.3503220522760686,
            "delta_doc_logPPL_if_removed": -0.00025665387787920935,
            "excerpt": "## 4) Recommended Iteration Loop"
          },
          {
            "paragraph_id": 17,
            "char_start": 1921,
            "char_end": 1965,
            "logPPL": 3.4112658023727973,
            "delta_doc_logPPL_if_removed": -0.004169770521850413,
            "excerpt": "For efficient throughput, use this sequence:"
          },
          {
            "paragraph_id": 18,
            "char_start": 1967,
            "char_end": 2412,
            "logPPL": 1.9005288789770565,
            "delta_doc_logPPL_if_removed": 0.019460181752707584,
            "excerpt": "1. Press `Analyze` on the current document. 2. Inspect red and green contributors. 3. Edit directly or request rewrites. 4. Apply one or ..."
          },
          {
            "paragraph_id": 19,
            "char_start": 2414,
            "char_end": 2606,
            "logPPL": 2.1499814650300597,
            "delta_doc_logPPL_if_removed": 0.0029479824429730073,
            "excerpt": "Recommended cadence: - Run `Analyze` every few rewrites (for example, every 3–8), or after a major section change. - Run `Clear Priors` i..."
          },
          {
            "paragraph_id": 20,
            "char_start": 2608,
            "char_end": 2660,
            "logPPL": 3.2214529662502405,
            "delta_doc_logPPL_if_removed": -0.006965043565861251,
            "excerpt": "### 4.1) Chunk-Aware Analyze Behaviour (Large Files)"
          },
          {
            "paragraph_id": 21,
            "char_start": 2662,
            "char_end": 2733,
            "logPPL": 1.9747911967956553,
            "delta_doc_logPPL_if_removed": 0.0022652147919699495,
            "excerpt": "When a document is too large for one-pass scoring, analysis is chunked."
          },
          {
            "paragraph_id": 22,
            "char_start": 2735,
            "char_end": 3313,
            "logPPL": 2.7557686051085293,
            "delta_doc_logPPL_if_removed": -0.0282014033711131,
            "excerpt": "- First `Analyze` starts at line 1 (document start) and scores the first token-limited chunk. - `Analyze Next` continues from the highest..."
          },
          {
            "paragraph_id": 23,
            "char_start": 3315,
            "char_end": 3332,
            "logPPL": 4.598981846582281,
            "delta_doc_logPPL_if_removed": -0.003199050244176327,
            "excerpt": "Concrete example:"
          },
          {
            "paragraph_id": 24,
            "char_start": 3334,
            "char_end": 3806,
            "logPPL": 1.986973867199954,
            "delta_doc_logPPL_if_removed": 0.01804686772645203,
            "excerpt": "1. First `Analyze` produces chunk 1 covering lines `1-999`. 2. You move cursor to line `999` and press `Analyze`. 3. Binoculars re-analyz..."
          },
          {
            "paragraph_id": 25,
            "char_start": 3808,
            "char_end": 3833,
            "logPPL": 0.9993115049348247,
            "delta_doc_logPPL_if_removed": 0.0047263264719275,
            "excerpt": "## 5) Requesting Rewrites"
          },
          {
            "paragraph_id": 26,
            "char_start": 3835,
            "char_end": 3877,
            "logPPL": 4.711825288073063,
            "delta_doc_logPPL_if_removed": -0.011218682595463658,
            "excerpt": "### A) Rewrite a Single Scored Red Segment"
          },
          {
            "paragraph_id": 27,
            "char_start": 3879,
            "char_end": 4246,
            "logPPL": 1.5569111162842961,
            "delta_doc_logPPL_if_removed": 0.03375533094957861,
            "excerpt": "1. Ensure at least one successful `Analyze` run has completed. 2. Right-click directly on a red (`LOW`) segment. 3. Wait for the popup to..."
          },
          {
            "paragraph_id": 28,
            "char_start": 4248,
            "char_end": 4295,
            "logPPL": 1.693498783804776,
            "delta_doc_logPPL_if_removed": 0.0032548987667326834,
            "excerpt": "### B) Rewrite a Highlighted Block (Multi-Line)"
          },
          {
            "paragraph_id": 29,
            "char_start": 4297,
            "char_end": 4733,
            "logPPL": 1.9045820713232007,
            "delta_doc_logPPL_if_removed": 0.01830039717225551,
            "excerpt": "1. Highlight any block in the left pane (may include mixed LOW/HIGH/neutral lines). 2. Right-click while the selection is active. 3. The ..."
          },
          {
            "paragraph_id": 30,
            "char_start": 4735,
            "char_end": 4934,
            "logPPL": 2.7160983827827265,
            "delta_doc_logPPL_if_removed": -0.007734334408401988,
            "excerpt": "Selection rewrite behaviour: - Unchanged source lines are preserved, even if the model output omits or collapses them. - Trailing blank l..."
          },
          {
            "paragraph_id": 31,
            "char_start": 4936,
            "char_end": 4963,
            "logPPL": 1.7254289279418629,
            "delta_doc_logPPL_if_removed": 0.0017913156183686496,
            "excerpt": "## 6) Rewrite Popup Details"
          },
          {
            "paragraph_id": 32,
            "char_start": 4965,
            "char_end": 5223,
            "logPPL": 2.7433380574587614,
            "delta_doc_logPPL_if_removed": -0.013560888815605576,
            "excerpt": "Popup features: - Scrollable option body for long rewrites. - Status and progress lines during generation. - Source label indicates the r..."
          },
          {
            "paragraph_id": 33,
            "char_start": 5225,
            "char_end": 5298,
            "logPPL": 3.0655591243428875,
            "delta_doc_logPPL_if_removed": -0.005810808734524997,
            "excerpt": "Option order: - Sorted by expected increase in B (most human-like first)."
          },
          {
            "paragraph_id": 34,
            "char_start": 5300,
            "char_end": 5339,
            "logPPL": 3.4438502389779404,
            "delta_doc_logPPL_if_removed": -0.005906855107460807,
            "excerpt": "## 7) Synonym Finder and One-Level Undo"
          },
          {
            "paragraph_id": 35,
            "char_start": 5341,
            "char_end": 5674,
            "logPPL": 1.8514606245782952,
            "delta_doc_logPPL_if_removed": 0.01426166594876399,
            "excerpt": "The synonym finder operates as follows. Left-click a word in the left pane. After a brief delay, the synonym panel appears, displaying up..."
          },
          {
            "paragraph_id": 36,
            "char_start": 5676,
            "char_end": 5826,
            "logPPL": 2.637547501195015,
            "delta_doc_logPPL_if_removed": -0.0056610195394322105,
            "excerpt": "Synonym sources are prioritized in this order: the local fallback list, WordNet (if available in the environment), and the Datamuse API a..."
          },
          {
            "paragraph_id": 37,
            "char_start": 5828,
            "char_end": 6229,
            "logPPL": 2.2690925995965245,
            "delta_doc_logPPL_if_removed": 0.00040400399852114077,
            "excerpt": "One-level Undo is supported. The command `Undo` reverts exactly one tracked operation. Supported tracked operations include selected-bloc..."
          },
          {
            "paragraph_id": 38,
            "char_start": 6231,
            "char_end": 6265,
            "logPPL": 1.4506915322211813,
            "delta_doc_logPPL_if_removed": 0.0034457597494164105,
            "excerpt": "## 8) Exact vs Approximate Metrics"
          },
          {
            "paragraph_id": 39,
            "char_start": 6267,
            "char_end": 6392,
            "logPPL": 3.0664192745363557,
            "delta_doc_logPPL_if_removed": -0.008758188628707142,
            "excerpt": "Approximate values in the popup are designed for quickly ranking options. They do not recompute the full document cross term."
          },
          {
            "paragraph_id": 40,
            "char_start": 6394,
            "char_end": 6560,
            "logPPL": 2.603571644850904,
            "delta_doc_logPPL_if_removed": -0.006814056934646651,
            "excerpt": "Exact values in the status bar are updated only by `Analyze`. These include exact `B`, `Observer logPPL`, `Performer logPPL`, `Cross logX..."
          },
          {
            "paragraph_id": 41,
            "char_start": 6562,
            "char_end": 6601,
            "logPPL": 1.1721439672147118,
            "delta_doc_logPPL_if_removed": 0.006659753434139493,
            "excerpt": "## 9) Prior Overlays and `Clear Priors`"
          },
          {
            "paragraph_id": 42,
            "char_start": 6603,
            "char_end": 6720,
            "logPPL": 2.6273354071903103,
            "delta_doc_logPPL_if_removed": -0.003538361961110237,
            "excerpt": "Priors are faint background traces of previous analyzes and edits. They provide visual context for “before vs after”."
          },
          {
            "paragraph_id": 43,
            "char_start": 6722,
            "char_end": 6897,
            "logPPL": 2.6895947691675084,
            "delta_doc_logPPL_if_removed": -0.0059061500398294164,
            "excerpt": "Clearing priors is recommended after several iteration cycles when old context becomes distracting, or before a final review pass if only..."
          },
          {
            "paragraph_id": 44,
            "char_start": 6899,
            "char_end": 7019,
            "logPPL": 1.612426237310888,
            "delta_doc_logPPL_if_removed": 0.008078137536241314,
            "excerpt": "The `Clear Priors` command removes faint prior backgrounds. It does not alter the current text and does not run Analyze."
          },
          {
            "paragraph_id": 45,
            "char_start": 7021,
            "char_end": 7060,
            "logPPL": 2.8252586083872644,
            "delta_doc_logPPL_if_removed": -0.002260468887804734,
            "excerpt": "## 10) Preview Pane Selection Mirroring"
          },
          {
            "paragraph_id": 46,
            "char_start": 7062,
            "char_end": 7314,
            "logPPL": 1.966828145482378,
            "delta_doc_logPPL_if_removed": 0.0076815286851732445,
            "excerpt": "When a block is highlighted on the left, the right preview mirrors the same selected block. Within the selected block, LOW lines display ..."
          },
          {
            "paragraph_id": 47,
            "char_start": 7316,
            "char_end": 7398,
            "logPPL": 2.673217118810262,
            "delta_doc_logPPL_if_removed": -0.0025403258846226073,
            "excerpt": "This approach makes it easier to inspect local context before requesting rewrites."
          },
          {
            "paragraph_id": 48,
            "char_start": 7400,
            "char_end": 7430,
            "logPPL": 1.8026881387154123,
            "delta_doc_logPPL_if_removed": 0.0017632038023811525,
            "excerpt": "## 11) Saving and Output Files"
          },
          {
            "paragraph_id": 49,
            "char_start": 7432,
            "char_end": 7500,
            "logPPL": 2.425687446136898,
            "delta_doc_logPPL_if_removed": -0.0008707757830452856,
            "excerpt": "`Save` creates timestamped files alongside the original source file."
          },
          {
            "paragraph_id": 50,
            "char_start": 7502,
            "char_end": 7605,
            "logPPL": 2.7594106591185428,
            "delta_doc_logPPL_if_removed": -0.006914674079196548,
            "excerpt": "- `[[HTML_BLOCK_0]]_edited_YYYYMMDDHHMM.md` - If a filename conflict occurs, a numeric suffix is added."
          },
          {
            "paragraph_id": 51,
            "char_start": 7607,
            "char_end": 7787,
            "logPPL": 3.3182768534215104,
            "delta_doc_logPPL_if_removed": -0.01695326934289909,
            "excerpt": "Tip: Save snapshots at key points - such as after each Analyze-confirmed change. When you save, a modal popup displays the destination fi..."
          },
          {
            "paragraph_id": 52,
            "char_start": 7789,
            "char_end": 7860,
            "logPPL": 2.973118672685443,
            "delta_doc_logPPL_if_removed": -0.005772521655807772,
            "excerpt": "## 12) Optional External Rewrite Backend (`Config.Binoculars.Llm.Json`)"
          },
          {
            "paragraph_id": 53,
            "char_start": 7862,
            "char_end": 8081,
            "logPPL": 2.210849446225753,
            "delta_doc_logPPL_if_removed": 0.001274838920955812,
            "excerpt": "If an external backend is configured and available, rewrite generation can use any OpenAI-compatible endpoint. If the configuration is mi..."
          },
          {
            "paragraph_id": 54,
            "char_start": 8083,
            "char_end": 8430,
            "logPPL": 1.5774043965996385,
            "delta_doc_logPPL_if_removed": 0.035641843228198855,
            "excerpt": "Typical fields include: - `llm.enabled` - `llm.endpoint_url` - `llm.request_path` - `llm.model` - `llm.api_key` or `llm.api_key_env` - `l..."
          },
          {
            "paragraph_id": 55,
            "char_start": 8432,
            "char_end": 8454,
            "logPPL": 0.8675555916257695,
            "delta_doc_logPPL_if_removed": 0.00455864896132363,
            "excerpt": "## 13) Troubleshooting"
          },
          {
            "paragraph_id": 56,
            "char_start": 8456,
            "char_end": 8616,
            "logPPL": 1.9696763997909195,
            "delta_doc_logPPL_if_removed": 0.0050826857817836135,
            "excerpt": "Rewrite menu will not open: - Run `Analyze` at least once before attempting to open the menu. - Make sure no analysis or rewrite operatio..."
          },
          {
            "paragraph_id": 57,
            "char_start": 8618,
            "char_end": 8811,
            "logPPL": 2.006792981988514,
            "delta_doc_logPPL_if_removed": 0.005650973584854224,
            "excerpt": "Rewrite generation is slow: - The first run may require model warmup. - Latency from an external endpoint can be significant. - If needed..."
          },
          {
            "paragraph_id": 58,
            "char_start": 8813,
            "char_end": 8974,
            "logPPL": 1.5441330779216633,
            "delta_doc_logPPL_if_removed": 0.010988959503432039,
            "excerpt": "Undo button is disabled or Undo fails: - Undo supports only one tracked operation at a time. - If the document changes after that operati..."
          },
          {
            "paragraph_id": 59,
            "char_start": 8976,
            "char_end": 9085,
            "logPPL": 1.3876769016511785,
            "delta_doc_logPPL_if_removed": 0.01079477292775799,
            "excerpt": "B score does not match popup deltas: - Popup deltas are approximate. - Run a full `Analyze` for exact values."
          },
          {
            "paragraph_id": 60,
            "char_start": 9087,
            "char_end": 9257,
            "logPPL": 3.051986903729129,
            "delta_doc_logPPL_if_removed": -0.01077666698779245,
            "excerpt": "Status-bar messages disappear: - Non-analysis workflow messages are temporary; metrics are restored automatically. - `Analyzing...` stays..."
          },
          {
            "paragraph_id": 61,
            "char_start": 9259,
            "char_end": 9339,
            "logPPL": 2.667469585906021,
            "delta_doc_logPPL_if_removed": -0.0032242661847425858,
            "excerpt": "Visual clutter is high: - Use `Clear Priors` and continue the iteration process."
          },
          {
            "paragraph_id": 62,
            "char_start": 9341,
            "char_end": 9344,
            "logPPL": 7.2495689562626495,
            "delta_doc_logPPL_if_removed": -0.0022834706740013644,
            "excerpt": "---"
          },
          {
            "paragraph_id": 63,
            "char_start": 9346,
            "char_end": 9644,
            "logPPL": 1.9521299581689473,
            "delta_doc_logPPL_if_removed": 0.010756105308933783,
            "excerpt": "Practical summary: - Use rewrites, synonym swaps, and direct edits for rapid local iteration. - Rely on popup numbers for relative rankin..."
          }
        ]
      }
    ],
    "analysis_chunk_id_seq": 1,
    "analysis_covered_until": 9645,
    "analysis_next_available": true
  }
}